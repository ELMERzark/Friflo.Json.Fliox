{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$comment": "Generated by: https://github.com/friflo/Friflo.Json.Fliox#schema",
    "definitions": {
        "TaskRight": {
            "discriminator": "type",
            "oneOf": [
                { "$ref": "#/definitions/DbFullRight" },
                { "$ref": "#/definitions/DbTaskRight" },
                { "$ref": "#/definitions/DbContainerRight" },
                { "$ref": "#/definitions/SendMessageRight" },
                { "$ref": "#/definitions/SubscribeMessageRight" },
                { "$ref": "#/definitions/PredicateRight" }
            ],
            "properties": {
                "type":        { "enum": ["dbFull", "dbTask", "dbContainer", "sendMessage", "subscribeMessage", "predicate"], "description": "right type" },
                "description": { "type": ["string", "null"], "description": "optional description explaining the Right" }
            },
            "required": [
                "type"
            ],
            "additionalProperties": true
        },
        "DbFullRight": {
            "type": "object",
            "extends": { "$ref": "#/definitions/TaskRight" },
            "description": "Allow full access to the given <b>database</b>.<br/>",
            "properties": {
                "type":        { "enum": ["dbFull"] },
                "description": { "type": ["string", "null"], "description": "optional description explaining the Right" },
                "database":    { "type": "string", "description": "a specific database: 'test_db', multiple databases by prefix: 'test_*', all databases: '*'" }
            },
            "required": [
                "type",
                "database"
            ],
            "additionalProperties": false
        },
        "DbTaskRight": {
            "type": "object",
            "extends": { "$ref": "#/definitions/TaskRight" },
            "description": "<b>DbTaskRight</b> grant <b>database</b> access by a set of task <b>types</b>. <br/>",
            "properties": {
                "type":        { "enum": ["dbTask"] },
                "description": { "type": ["string", "null"], "description": "optional description explaining the Right" },
                "database":    { "type": "string", "description": "a specific database: 'test_db', multiple databases by prefix: 'test_*', all databases: '*'" },
                "types":       { "type": "array", "items": { "$ref": "./Friflo.Json.Fliox.Hub.Protocol.Tasks.json#/definitions/TaskType" }, "description": "set fo task types like: create, read, upsert, delete, query, ..." }
            },
            "required": [
                "type",
                "database",
                "types"
            ],
            "additionalProperties": false
        },
        "DbContainerRight": {
            "type": "object",
            "extends": { "$ref": "#/definitions/TaskRight" },
            "description": "<b>DbContainerRight</b> grant <b>database</b> access for the given <b>containers</b>\nbased on a set of <b>operations</b>. <br/>\nE.g. create, read, upsert, delete, query or aggregate (count)<br/>\nIt also allows subscribing database changes by <b>subscribeChanges</b>",
            "properties": {
                "type":        { "enum": ["dbContainer"] },
                "description": { "type": ["string", "null"], "description": "optional description explaining the Right" },
                "database":    { "type": "string", "description": "a specific database: 'test_db', multiple databases by prefix: 'test_*', all databases: '*'" },
                "containers":  { "type": "array", "items": { "$ref": "#/definitions/ContainerAccess" }, "description": "grant execution of operations and subscriptions on listed <b>containers</b>" }
            },
            "required": [
                "type",
                "database",
                "containers"
            ],
            "additionalProperties": false
        },
        "ContainerAccess": {
            "type": "object",
            "description": "Grant execution of specific container operations and subscriptions",
            "properties": {
                "name":             { "type": "string", "description": "Container name" },
                "operations":       { "type": ["array", "null"], "items": { "$ref": "#/definitions/OperationType" }, "description": "Set of granted operation types" },
                "subscribeChanges": { "type": ["array", "null"], "items": { "$ref": "./Friflo.Json.Fliox.Hub.Protocol.Tasks.json#/definitions/EntityChange" }, "description": "Set of granted change subscriptions" }
            },
            "required": [
                "name"
            ],
            "additionalProperties": false
        },
        "OperationType": {
            "enum": [
                "create",
                "upsert",
                "delete",
                "deleteAll",
                "merge",
                "read",
                "query",
                "aggregate",
                "mutate",
                "full"
            ],
            "descriptions": {
                "create":    "allow to create entities in a container",
                "upsert":    "allow to upsert entities in a container",
                "delete":    "allow to delete entities in a container",
                "deleteAll": "allow to delete all container entities",
                "merge":     "allow to patch entities in a container",
                "read":      "allow to read entities in a container",
                "query":     "allow to query entities in a container",
                "aggregate": "allow to aggregate - count - entities in a container",
                "mutate":    "allow to mutate - create, upsert, delete and patch - entities in a container",
                "full":      "allow all operation types in a container"
            }

        },
        "SendMessageRight": {
            "type": "object",
            "extends": { "$ref": "#/definitions/TaskRight" },
            "description": "<b>SendMessageRight</b> allows sending messages to a <b>database</b> by a set of <b>names</b>.<br/><br/>\nNote: commands are messages - so permission of sending commands is same as for messages.",
            "properties": {
                "type":        { "enum": ["sendMessage"] },
                "description": { "type": ["string", "null"], "description": "optional description explaining the Right" },
                "database":    { "type": "string", "description": "a specific database: 'test_db', multiple databases by prefix: 'test_*', all databases: '*'" },
                "names":       { "type": "array", "items": { "type": "string" }, "description": "a specific message: 'std.Echo', multiple messages by prefix: 'std.*', all messages: '*'" }
            },
            "required": [
                "type",
                "database",
                "names"
            ],
            "additionalProperties": false
        },
        "SubscribeMessageRight": {
            "type": "object",
            "extends": { "$ref": "#/definitions/TaskRight" },
            "description": "<b>SubscribeMessageRight</b> allows subscribing messages send to a <b>database</b>.<br/><br/>\nNote: commands are messages - so permission of subscribing commands is same as for messages.",
            "properties": {
                "type":        { "enum": ["subscribeMessage"] },
                "description": { "type": ["string", "null"], "description": "optional description explaining the Right" },
                "database":    { "type": "string", "description": "a specific database: 'test_db', multiple databases by prefix: 'test_*', all databases: '*'" },
                "names":       { "type": "array", "items": { "type": "string" }, "description": "a specific message: 'std.Echo', multiple messages by prefix: 'std.*', all messages: '*'" }
            },
            "required": [
                "type",
                "database",
                "names"
            ],
            "additionalProperties": false
        },
        "PredicateRight": {
            "type": "object",
            "extends": { "$ref": "#/definitions/TaskRight" },
            "properties": {
                "type":        { "enum": ["predicate"] },
                "description": { "type": ["string", "null"], "description": "optional description explaining the Right" },
                "names":       { "type": "array", "items": { "type": "string" }, "description": "a specific predicate: 'TestPredicate', multiple predicates by prefix: 'Test*', all predicates: '*'" }
            },
            "required": [
                "type",
                "names"
            ],
            "additionalProperties": false
        },
        "HubRights": {
            "type": "object",
            "properties": {
                "queueEvents": { "type": ["boolean", "null"] }
            },
            "additionalProperties": false
        }
    }
}

