{
    "$comment": "Generated by: https://github.com/friflo/Friflo.Json.Flow/tree/main/Json/Flow/Schema",
    "definitions": {
        "DatabaseMessage": {
            "properties": {
                "req":  { "ref": "DatabaseRequest", "nullable": true },
                "resp": { "ref": "DatabaseResponse", "nullable": true },
                "ev":   { "ref": "DatabaseEvent", "nullable": true }
            },
            "additionalProperties": false
        },
        "DatabaseRequest": {
            "discriminator": "type",
            "mapping": {
                "sync": { "ref": "SyncRequest" }
            },
            "properties": {
                "reqId": { "ref": "int32", "nullable": true }
            },
            "additionalProperties": true
        },
        "SyncRequest": {
            "properties": {
                "reqId":  { "ref": "int32", "nullable": true },
                "client": { "type": "string" },
                "ack":    { "ref": "int32", "nullable": true },
                "token":  { "type": "string" },
                "tasks":  { "elements": { "ref": "DatabaseTask" } }
            },
            "required": [
                "tasks"
            ],
            "additionalProperties": false
        },
        "DatabaseTask": {
            "discriminator": "task",
            "mapping": {
                "create":           { "ref": "CreateEntities" },
                "update":           { "ref": "UpdateEntities" },
                "read":             { "ref": "ReadEntitiesList" },
                "query":            { "ref": "QueryEntities" },
                "patch":            { "ref": "PatchEntities" },
                "delete":           { "ref": "DeleteEntities" },
                "message":          { "ref": "SendMessage" },
                "subscribeChanges": { "ref": "SubscribeChanges" },
                "subscribeMessage": { "ref": "SubscribeMessage" }
            },
            "properties": {

            },
            "additionalProperties": true
        },
        "CreateEntities": {
            "properties": {
                "container": { "type": "string" },
                "entities":  { "type": "object", "additionalProperties": { "ref": "EntityValue" } }
            },
            "required": [
                "container",
                "entities"
            ],
            "additionalProperties": false
        },
        "EntityValue": {
            "properties": {
                "value": {  },
                "error": { "ref": "EntityError", "nullable": true }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "EntityError": {
            "properties": {
                "type":    { "ref": "EntityErrorType" },
                "message": { "type": "string" }
            },
            "required": [
                "type"
            ],
            "additionalProperties": false
        },
        "EntityErrorType": {
            "enum": [
                "Undefined",
                "ParseError",
                "ReadError",
                "WriteError",
                "DeleteError",
                "PatchError"
            ]
        },
        "UpdateEntities": {
            "properties": {
                "container": { "type": "string" },
                "entities":  { "type": "object", "additionalProperties": { "ref": "EntityValue" } }
            },
            "required": [
                "container",
                "entities"
            ],
            "additionalProperties": false
        },
        "ReadEntitiesList": {
            "properties": {
                "container": { "type": "string" },
                "reads":     { "elements": { "ref": "ReadEntities" } }
            },
            "required": [
                "container",
                "reads"
            ],
            "additionalProperties": false
        },
        "ReadEntities": {
            "properties": {
                "ids":        { "elements": { "type": "string" } },
                "references": { "elements": { "ref": "References" } }
            },
            "required": [
                "ids"
            ],
            "additionalProperties": false
        },
        "References": {
            "properties": {
                "selector":   { "type": "string" },
                "container":  { "type": "string" },
                "references": { "elements": { "ref": "References" } }
            },
            "required": [
                "selector",
                "container"
            ],
            "additionalProperties": false
        },
        "QueryEntities": {
            "properties": {
                "container":  { "type": "string" },
                "filterLinq": { "type": "string" },
                "filter":     { "ref": "FilterOperation", "nullable": true },
                "references": { "elements": { "ref": "References" } }
            },
            "required": [
                "container"
            ],
            "additionalProperties": false
        },
        "FilterOperation": {
            "discriminator": "op",
            "mapping": {
                "equal":              { "ref": "Equal" },
                "notEqual":           { "ref": "NotEqual" },
                "lessThan":           { "ref": "LessThan" },
                "lessThanOrEqual":    { "ref": "LessThanOrEqual" },
                "greaterThan":        { "ref": "GreaterThan" },
                "greaterThanOrEqual": { "ref": "GreaterThanOrEqual" },
                "and":                { "ref": "And" },
                "or":                 { "ref": "Or" },
                "true":               { "ref": "TrueLiteral" },
                "false":              { "ref": "FalseLiteral" },
                "not":                { "ref": "Not" },
                "any":                { "ref": "Any" },
                "all":                { "ref": "All" },
                "contains":           { "ref": "Contains" },
                "startsWith":         { "ref": "StartsWith" },
                "endsWith":           { "ref": "EndsWith" }
            },
            "properties": {

            },
            "additionalProperties": true
        },
        "Equal": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "Operation": {
            "discriminator": "op",
            "mapping": {
                "field":              { "ref": "Field" },
                "string":             { "ref": "StringLiteral" },
                "double":             { "ref": "DoubleLiteral" },
                "int64":              { "ref": "LongLiteral" },
                "null":               { "ref": "NullLiteral" },
                "abs":                { "ref": "Abs" },
                "ceiling":            { "ref": "Ceiling" },
                "floor":              { "ref": "Floor" },
                "exp":                { "ref": "Exp" },
                "log":                { "ref": "Log" },
                "sqrt":               { "ref": "Sqrt" },
                "negate":             { "ref": "Negate" },
                "add":                { "ref": "Add" },
                "subtract":           { "ref": "Subtract" },
                "multiply":           { "ref": "Multiply" },
                "divide":             { "ref": "Divide" },
                "min":                { "ref": "Min" },
                "max":                { "ref": "Max" },
                "sum":                { "ref": "Sum" },
                "average":            { "ref": "Average" },
                "count":              { "ref": "Count" },
                "equal":              { "ref": "Equal" },
                "notEqual":           { "ref": "NotEqual" },
                "lessThan":           { "ref": "LessThan" },
                "lessThanOrEqual":    { "ref": "LessThanOrEqual" },
                "greaterThan":        { "ref": "GreaterThan" },
                "greaterThanOrEqual": { "ref": "GreaterThanOrEqual" },
                "and":                { "ref": "And" },
                "or":                 { "ref": "Or" },
                "true":               { "ref": "TrueLiteral" },
                "false":              { "ref": "FalseLiteral" },
                "not":                { "ref": "Not" },
                "any":                { "ref": "Any" },
                "all":                { "ref": "All" },
                "contains":           { "ref": "Contains" },
                "startsWith":         { "ref": "StartsWith" },
                "endsWith":           { "ref": "EndsWith" }
            },
            "properties": {

            },
            "additionalProperties": true
        },
        "Field": {
            "properties": {
                "name": { "type": "string" }
            },
            "required": [
                "name"
            ],
            "additionalProperties": false
        },
        "StringLiteral": {
            "properties": {
                "value": { "type": "string" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "DoubleLiteral": {
            "properties": {
                "value": { "ref": "double" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "LongLiteral": {
            "properties": {
                "value": { "ref": "int64" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "NullLiteral": {
            "properties": {

            },
            "additionalProperties": false
        },
        "Abs": {
            "properties": {
                "value": { "ref": "Operation" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "Ceiling": {
            "properties": {
                "value": { "ref": "Operation" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "Floor": {
            "properties": {
                "value": { "ref": "Operation" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "Exp": {
            "properties": {
                "value": { "ref": "Operation" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "Log": {
            "properties": {
                "value": { "ref": "Operation" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "Sqrt": {
            "properties": {
                "value": { "ref": "Operation" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "Negate": {
            "properties": {
                "value": { "ref": "Operation" }
            },
            "required": [
                "value"
            ],
            "additionalProperties": false
        },
        "Add": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "Subtract": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "Multiply": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "Divide": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "Min": {
            "properties": {
                "field": { "ref": "Field" },
                "arg":   { "type": "string" },
                "array": { "ref": "Operation" }
            },
            "required": [
                "field",
                "arg",
                "array"
            ],
            "additionalProperties": false
        },
        "Max": {
            "properties": {
                "field": { "ref": "Field" },
                "arg":   { "type": "string" },
                "array": { "ref": "Operation" }
            },
            "required": [
                "field",
                "arg",
                "array"
            ],
            "additionalProperties": false
        },
        "Sum": {
            "properties": {
                "field": { "ref": "Field" },
                "arg":   { "type": "string" },
                "array": { "ref": "Operation" }
            },
            "required": [
                "field",
                "arg",
                "array"
            ],
            "additionalProperties": false
        },
        "Average": {
            "properties": {
                "field": { "ref": "Field" },
                "arg":   { "type": "string" },
                "array": { "ref": "Operation" }
            },
            "required": [
                "field",
                "arg",
                "array"
            ],
            "additionalProperties": false
        },
        "Count": {
            "properties": {
                "field": { "ref": "Field" }
            },
            "required": [
                "field"
            ],
            "additionalProperties": false
        },
        "NotEqual": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "LessThan": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "LessThanOrEqual": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "GreaterThan": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "GreaterThanOrEqual": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "And": {
            "properties": {
                "operands": { "elements": { "ref": "FilterOperation" } }
            },
            "required": [
                "operands"
            ],
            "additionalProperties": false
        },
        "Or": {
            "properties": {
                "operands": { "elements": { "ref": "FilterOperation" } }
            },
            "required": [
                "operands"
            ],
            "additionalProperties": false
        },
        "TrueLiteral": {
            "properties": {

            },
            "additionalProperties": false
        },
        "FalseLiteral": {
            "properties": {

            },
            "additionalProperties": false
        },
        "Not": {
            "properties": {
                "operand": { "ref": "FilterOperation" }
            },
            "required": [
                "operand"
            ],
            "additionalProperties": false
        },
        "Any": {
            "properties": {
                "field":     { "ref": "Field" },
                "arg":       { "type": "string" },
                "predicate": { "ref": "FilterOperation" }
            },
            "required": [
                "field",
                "arg",
                "predicate"
            ],
            "additionalProperties": false
        },
        "All": {
            "properties": {
                "field":     { "ref": "Field" },
                "arg":       { "type": "string" },
                "predicate": { "ref": "FilterOperation" }
            },
            "required": [
                "field",
                "arg",
                "predicate"
            ],
            "additionalProperties": false
        },
        "Contains": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "StartsWith": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "EndsWith": {
            "properties": {
                "left":  { "ref": "Operation" },
                "right": { "ref": "Operation" }
            },
            "required": [
                "left",
                "right"
            ],
            "additionalProperties": false
        },
        "PatchEntities": {
            "properties": {
                "container": { "type": "string" },
                "patches":   { "type": "object", "additionalProperties": { "ref": "EntityPatch" } }
            },
            "required": [
                "container",
                "patches"
            ],
            "additionalProperties": false
        },
        "EntityPatch": {
            "properties": {
                "patches": { "elements": { "ref": "JsonPatch" } }
            },
            "required": [
                "patches"
            ],
            "additionalProperties": false
        },
        "JsonPatch": {
            "discriminator": "op",
            "mapping": {
                "replace": { "ref": "PatchReplace" },
                "add":     { "ref": "PatchAdd" },
                "remove":  { "ref": "PatchRemove" },
                "copy":    { "ref": "PatchCopy" },
                "move":    { "ref": "PatchMove" },
                "test":    { "ref": "PatchTest" }
            },
            "properties": {

            },
            "additionalProperties": true
        },
        "PatchReplace": {
            "properties": {
                "path":  { "type": "string" },
                "value": {  }
            },
            "required": [
                "path",
                "value"
            ],
            "additionalProperties": false
        },
        "PatchAdd": {
            "properties": {
                "path":  { "type": "string" },
                "value": {  }
            },
            "required": [
                "path",
                "value"
            ],
            "additionalProperties": false
        },
        "PatchRemove": {
            "properties": {
                "path": { "type": "string" }
            },
            "required": [
                "path"
            ],
            "additionalProperties": false
        },
        "PatchCopy": {
            "properties": {
                "path": { "type": "string" },
                "from": { "type": "string" }
            },
            "required": [
                "path"
            ],
            "additionalProperties": false
        },
        "PatchMove": {
            "properties": {
                "path": { "type": "string" },
                "from": { "type": "string" }
            },
            "required": [
                "path"
            ],
            "additionalProperties": false
        },
        "PatchTest": {
            "properties": {
                "path":  { "type": "string" },
                "value": {  }
            },
            "required": [
                "path",
                "value"
            ],
            "additionalProperties": false
        },
        "DeleteEntities": {
            "properties": {
                "container": { "type": "string" },
                "ids":       { "elements": { "type": "string" } }
            },
            "required": [
                "container",
                "ids"
            ],
            "additionalProperties": false
        },
        "SendMessage": {
            "properties": {
                "name":  { "type": "string" },
                "value": {  }
            },
            "required": [
                "name",
                "value"
            ],
            "additionalProperties": false
        },
        "SubscribeChanges": {
            "properties": {
                "container": { "type": "string" },
                "changes":   { "elements": { "ref": "Change" } },
                "filter":    { "ref": "FilterOperation", "nullable": true }
            },
            "required": [
                "container",
                "changes"
            ],
            "additionalProperties": false
        },
        "Change": {
            "enum": [
                "create",
                "update",
                "patch",
                "delete"
            ]
        },
        "SubscribeMessage": {
            "properties": {
                "name":   { "type": "string" },
                "remove": { "type": "boolean" }
            },
            "required": [
                "name"
            ],
            "additionalProperties": false
        },
        "DatabaseResponse": {
            "discriminator": "type",
            "mapping": {
                "sync":  { "ref": "SyncResponse" },
                "error": { "ref": "ErrorResponse" }
            },
            "properties": {
                "reqId": { "ref": "int32", "nullable": true }
            },
            "additionalProperties": true
        },
        "SyncResponse": {
            "properties": {
                "reqId":        { "ref": "int32", "nullable": true },
                "error":        { "ref": "ErrorResponse", "nullable": true },
                "tasks":        { "elements": { "ref": "TaskResult" } },
                "results":      { "type": "object", "additionalProperties": { "ref": "ContainerEntities" } },
                "createErrors": { "type": "object", "additionalProperties": { "ref": "EntityErrors" } },
                "updateErrors": { "type": "object", "additionalProperties": { "ref": "EntityErrors" } },
                "patchErrors":  { "type": "object", "additionalProperties": { "ref": "EntityErrors" } },
                "deleteErrors": { "type": "object", "additionalProperties": { "ref": "EntityErrors" } }
            },
            "additionalProperties": false
        },
        "ErrorResponse": {
            "properties": {
                "reqId":   { "ref": "int32", "nullable": true },
                "message": { "type": "string" }
            },
            "additionalProperties": false
        },
        "TaskResult": {
            "discriminator": "task",
            "mapping": {
                "create":           { "ref": "CreateEntitiesResult" },
                "update":           { "ref": "UpdateEntitiesResult" },
                "read":             { "ref": "ReadEntitiesListResult" },
                "query":            { "ref": "QueryEntitiesResult" },
                "patch":            { "ref": "PatchEntitiesResult" },
                "delete":           { "ref": "DeleteEntitiesResult" },
                "message":          { "ref": "SendMessageResult" },
                "subscribeChanges": { "ref": "SubscribeChangesResult" },
                "subscribeMessage": { "ref": "SubscribeMessageResult" },
                "error":            { "ref": "TaskErrorResult" }
            },
            "properties": {

            },
            "additionalProperties": true
        },
        "CreateEntitiesResult": {
            "properties": {
                "Error": { "ref": "CommandError", "nullable": true }
            },
            "additionalProperties": false
        },
        "CommandError": {
            "properties": {
                "message": { "type": "string" }
            },
            "additionalProperties": false
        },
        "UpdateEntitiesResult": {
            "properties": {
                "Error": { "ref": "CommandError", "nullable": true }
            },
            "additionalProperties": false
        },
        "ReadEntitiesListResult": {
            "properties": {
                "reads": { "elements": { "ref": "ReadEntitiesResult" } }
            },
            "required": [
                "reads"
            ],
            "additionalProperties": false
        },
        "ReadEntitiesResult": {
            "properties": {
                "Error":      { "ref": "CommandError", "nullable": true },
                "references": { "elements": { "ref": "ReferencesResult" } }
            },
            "required": [
                "references"
            ],
            "additionalProperties": false
        },
        "ReferencesResult": {
            "properties": {
                "error":      { "type": "string" },
                "container":  { "type": "string" },
                "ids":        { "elements": { "type": "string" } },
                "references": { "elements": { "ref": "ReferencesResult" } }
            },
            "required": [
                "ids"
            ],
            "additionalProperties": false
        },
        "QueryEntitiesResult": {
            "properties": {
                "Error":      { "ref": "CommandError", "nullable": true },
                "container":  { "type": "string" },
                "filterLinq": { "type": "string" },
                "ids":        { "elements": { "type": "string" } },
                "references": { "elements": { "ref": "ReferencesResult" } }
            },
            "required": [
                "ids"
            ],
            "additionalProperties": false
        },
        "PatchEntitiesResult": {
            "properties": {
                "Error": { "ref": "CommandError", "nullable": true }
            },
            "additionalProperties": false
        },
        "DeleteEntitiesResult": {
            "properties": {
                "Error": { "ref": "CommandError", "nullable": true }
            },
            "additionalProperties": false
        },
        "SendMessageResult": {
            "properties": {
                "Error":  { "ref": "CommandError", "nullable": true },
                "result": {  }
            },
            "required": [
                "result"
            ],
            "additionalProperties": false
        },
        "SubscribeChangesResult": {
            "properties": {

            },
            "additionalProperties": false
        },
        "SubscribeMessageResult": {
            "properties": {

            },
            "additionalProperties": false
        },
        "TaskErrorResult": {
            "properties": {
                "type":       { "ref": "TaskErrorResultType" },
                "message":    { "type": "string" },
                "stacktrace": { "type": "string" }
            },
            "required": [
                "type"
            ],
            "additionalProperties": false
        },
        "TaskErrorResultType": {
            "enum": [
                "None",
                "UnhandledException",
                "DatabaseError",
                "InvalidTask",
                "PermissionDenied",
                "SyncError"
            ]
        },
        "ContainerEntities": {
            "properties": {
                "container": { "type": "string" },
                "entities":  { "type": "object", "additionalProperties": { "ref": "EntityValue" } }
            },
            "required": [
                "entities"
            ],
            "additionalProperties": false
        },
        "EntityErrors": {
            "properties": {
                "container": { "type": "string" },
                "errors":    { "type": "object", "additionalProperties": { "ref": "EntityError" } }
            },
            "required": [
                "errors"
            ],
            "additionalProperties": false
        },
        "DatabaseEvent": {
            "discriminator": "type",
            "mapping": {
                "subscription": { "ref": "SubscriptionEvent" }
            },
            "properties": {
                "seq":    { "ref": "int32" },
                "target": { "type": "string" },
                "client": { "type": "string" }
            },
            "required": [
                "seq"
            ],
            "additionalProperties": true
        },
        "SubscriptionEvent": {
            "properties": {
                "seq":    { "ref": "int32" },
                "target": { "type": "string" },
                "client": { "type": "string" },
                "tasks":  { "elements": { "ref": "DatabaseTask" } }
            },
            "required": [
                "seq"
            ],
            "additionalProperties": false
        }
    }
}

