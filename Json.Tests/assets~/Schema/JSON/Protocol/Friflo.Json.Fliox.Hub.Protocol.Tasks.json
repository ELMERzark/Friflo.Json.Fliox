{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$comment": "Generated by: https://github.com/friflo/Friflo.Json.Fliox#schema",
    "definitions": {
        "SyncRequestTask": {
            "discriminator": "task",
            "oneOf": [
                { "$ref": "#/definitions/CreateEntities" },
                { "$ref": "#/definitions/UpsertEntities" },
                { "$ref": "#/definitions/ReadEntities" },
                { "$ref": "#/definitions/QueryEntities" },
                { "$ref": "#/definitions/AggregateEntities" },
                { "$ref": "#/definitions/PatchEntities" },
                { "$ref": "#/definitions/DeleteEntities" },
                { "$ref": "#/definitions/SendMessage" },
                { "$ref": "#/definitions/SendCommand" },
                { "$ref": "#/definitions/CloseCursors" },
                { "$ref": "#/definitions/SubscribeChanges" },
                { "$ref": "#/definitions/SubscribeMessage" },
                { "$ref": "#/definitions/ReserveKeys" }
            ],
            "properties": {
                "task": { "enum": ["create", "upsert", "read", "query", "aggregate", "patch", "delete", "message", "command", "closeCursors", "subscribeChanges", "subscribeMessage", "reserveKeys"] },
                "info": {  }
            },
            "required": [
                "task"
            ],
            "additionalProperties": true
        },
        "CreateEntities": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Create the given <b>entities</b> in the specified <b>container</b>",
            "properties": {
                "task":          { "enum": ["create"] },
                "container":     { "type": "string" },
                "reservedToken": { "oneOf": [{ "$ref": "./Standard.json#/definitions/Guid" }, {"type": "null"}] },
                "keyName":       { "type": ["string", "null"] },
                "entities":      { "type": "array", "items": {  } },
                "info":          {  }
            },
            "required": [
                "task",
                "container",
                "entities"
            ],
            "additionalProperties": false
        },
        "UpsertEntities": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Upsert the given <b>entities</b> in the specified <b>container</b>",
            "properties": {
                "task":      { "enum": ["upsert"] },
                "container": { "type": "string" },
                "keyName":   { "type": ["string", "null"] },
                "entities":  { "type": "array", "items": {  } },
                "info":      {  }
            },
            "required": [
                "task",
                "container",
                "entities"
            ],
            "additionalProperties": false
        },
        "ReadEntities": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Read entities by id from the specified <b>container</b> using read <b>sets</b><br/>\nEach <b>ReadEntitiesSet</b> contains a list of <b>ids</b>",
            "properties": {
                "task":      { "enum": ["read"] },
                "container": { "type": "string" },
                "keyName":   { "type": ["string", "null"] },
                "isIntKey":  { "type": ["boolean", "null"] },
                "sets":      { "type": "array", "items": { "$ref": "./Friflo.Json.Fliox.Hub.Protocol.Models.json#/definitions/ReadEntitiesSet" } },
                "info":      {  }
            },
            "required": [
                "task",
                "container",
                "sets"
            ],
            "additionalProperties": false
        },
        "QueryEntities": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Query entities from the given <b>container</b> using a <b>filter</b><br/>",
            "properties": {
                "task":       { "enum": ["query"] },
                "container":  { "type": "string" },
                "keyName":    { "type": ["string", "null"] },
                "isIntKey":   { "type": ["boolean", "null"] },
                "filterTree": {  },
                "filter":     { "type": ["string", "null"] },
                "references": { "type": ["array", "null"], "items": { "$ref": "./Friflo.Json.Fliox.Hub.Protocol.Models.json#/definitions/References" } },
                "limit":      { "oneOf": [{ "$ref": "./Standard.json#/definitions/int32" }, {"type": "null"}] },
                "maxCount":   { "oneOf": [{ "$ref": "./Standard.json#/definitions/int32" }, {"type": "null"}] },
                "cursor":     { "type": ["string", "null"] },
                "info":       {  }
            },
            "required": [
                "task",
                "container"
            ],
            "additionalProperties": false
        },
        "AggregateEntities": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Aggregate - count - entities from the given <b>container</b> using a <b>filter</b><br/>",
            "properties": {
                "task":       { "enum": ["aggregate"] },
                "container":  { "type": "string" },
                "type":       { "$ref": "#/definitions/AggregateType" },
                "filterTree": {  },
                "filter":     { "type": ["string", "null"] },
                "info":       {  }
            },
            "required": [
                "task",
                "container",
                "type"
            ],
            "additionalProperties": false
        },
        "AggregateType": {
            "enum": [
                "count"
            ]
        },
        "PatchEntities": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Patch entities by id in the given <b>container</b><br/>\nEach <b>EntityPatch</b> in <b>patches</b> contains a set of <b>patches</b> for each entity.",
            "properties": {
                "task":      { "enum": ["patch"] },
                "container": { "type": "string" },
                "keyName":   { "type": ["string", "null"] },
                "patches":   { "additionalProperties": { "$ref": "#/definitions/EntityPatch" }, "type": "object" },
                "info":      {  }
            },
            "required": [
                "task",
                "container",
                "patches"
            ],
            "additionalProperties": false
        },
        "EntityPatch": {
            "type": "object",
            "properties": {
                "patches": { "type": "array", "items": { "$ref": "./Friflo.Json.Fliox.Transform.json#/definitions/JsonPatch" } }
            },
            "required": [
                "patches"
            ],
            "additionalProperties": false
        },
        "DeleteEntities": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Delete entities by id in the given <b>container</b><br/>\nThe entities which will be deleted are listed in <b>ids</b>",
            "properties": {
                "task":      { "enum": ["delete"] },
                "container": { "type": "string" },
                "ids":       { "type": ["array", "null"], "items": { "type": "string" } },
                "all":       { "type": ["boolean", "null"] },
                "info":      {  }
            },
            "required": [
                "task",
                "container"
            ],
            "additionalProperties": false
        },
        "SendMessage": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncMessageTask" },
            "description": "Send a database message with the given <b>param</b><br/>",
            "properties": {
                "task":  { "enum": ["message"] },
                "name":  { "type": "string" },
                "param": {  },
                "info":  {  }
            },
            "required": [
                "task",
                "name"
            ],
            "additionalProperties": false
        },
        "SyncMessageTask": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "isAbstract": true,
            "properties": {
                "name":  { "type": "string" },
                "param": {  },
                "info":  {  }
            },
            "required": [
                "name"
            ],
            "additionalProperties": false
        },
        "SendCommand": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncMessageTask" },
            "description": "Send a database command with the given <b>param</b><br/>",
            "properties": {
                "task":  { "enum": ["command"] },
                "name":  { "type": "string" },
                "param": {  },
                "info":  {  }
            },
            "required": [
                "task",
                "name"
            ],
            "additionalProperties": false
        },
        "CloseCursors": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Close the <b>cursors</b> of the given <b>container</b>",
            "properties": {
                "task":      { "enum": ["closeCursors"] },
                "container": { "type": "string" },
                "cursors":   { "type": ["array", "null"], "items": { "type": "string" } },
                "info":      {  }
            },
            "required": [
                "task",
                "container"
            ],
            "additionalProperties": false
        },
        "SubscribeChanges": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Subscribe to specific <b>changes</b> of the specified <b>container</b> using the given <b>filter</b>",
            "properties": {
                "task":      { "enum": ["subscribeChanges"] },
                "container": { "type": "string" },
                "changes":   { "type": "array", "items": { "$ref": "#/definitions/Change" } },
                "filter":    {  },
                "info":      {  }
            },
            "required": [
                "task",
                "container",
                "changes"
            ],
            "additionalProperties": false
        },
        "Change": {
            "enum": [
                "create",
                "upsert",
                "patch",
                "delete"
            ],
            "descriptions": {
                "create": "filter change events of created entities.",
                "upsert": "filter change events of upserted entities.",
                "patch":  "filter change events of entity patches.",
                "delete": "filter change events of deleted entities."
            }

        },
        "SubscribeMessage": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "Subscribe to commands and messages sent to a database by their <b>name</b><br/>\nUnsubscribe by setting <b>remove</b> to true",
            "properties": {
                "task":   { "enum": ["subscribeMessage"] },
                "name":   { "type": "string", "description": "Subscribe all messages with the given <b>name</b>. <br/>\nSubscribe all messages         <b>name</b> = '*'<br/>\nSubscribe messages with prefix <b>name</b> = 'std.*' <br/>\nSubscribe a specific message   <b>name</b> = 'std.Echo'" },
                "remove": { "type": ["boolean", "null"] },
                "info":   {  }
            },
            "required": [
                "task",
                "name"
            ],
            "additionalProperties": false
        },
        "ReserveKeys": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncRequestTask" },
            "description": "WIP",
            "properties": {
                "task":      { "enum": ["reserveKeys"] },
                "container": { "type": "string" },
                "count":     { "$ref": "./Standard.json#/definitions/int32" },
                "info":      {  }
            },
            "required": [
                "task",
                "container",
                "count"
            ],
            "additionalProperties": false
        },
        "SyncTaskResult": {
            "discriminator": "task",
            "oneOf": [
                { "$ref": "#/definitions/CreateEntitiesResult" },
                { "$ref": "#/definitions/UpsertEntitiesResult" },
                { "$ref": "#/definitions/ReadEntitiesResult" },
                { "$ref": "#/definitions/QueryEntitiesResult" },
                { "$ref": "#/definitions/AggregateEntitiesResult" },
                { "$ref": "#/definitions/PatchEntitiesResult" },
                { "$ref": "#/definitions/DeleteEntitiesResult" },
                { "$ref": "#/definitions/SendMessageResult" },
                { "$ref": "#/definitions/SendCommandResult" },
                { "$ref": "#/definitions/CloseCursorsResult" },
                { "$ref": "#/definitions/SubscribeChangesResult" },
                { "$ref": "#/definitions/SubscribeMessageResult" },
                { "$ref": "#/definitions/ReserveKeysResult" },
                { "$ref": "#/definitions/TaskErrorResult" }
            ],
            "properties": {
                "task": { "enum": ["create", "upsert", "read", "query", "aggregate", "patch", "delete", "message", "command", "closeCursors", "subscribeChanges", "subscribeMessage", "reserveKeys", "error"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": true
        },
        "CreateEntitiesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["create"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "UpsertEntitiesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["upsert"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "ReadEntitiesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["read"] },
                "sets": { "type": "array", "items": { "$ref": "./Friflo.Json.Fliox.Hub.Protocol.Models.json#/definitions/ReadEntitiesSetResult" } }
            },
            "required": [
                "task",
                "sets"
            ],
            "additionalProperties": false
        },
        "QueryEntitiesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task":       { "enum": ["query"] },
                "container":  { "type": ["string", "null"] },
                "cursor":     { "type": ["string", "null"] },
                "count":      { "oneOf": [{ "$ref": "./Standard.json#/definitions/int32" }, {"type": "null"}], "description": "Is used only to show the number of <b>ids</b> in a serialized protocol message\nto avoid counting them by hand when debugging.\nIt is not used by the library as it is redundant information." },
                "ids":        { "type": "array", "items": { "type": "string" } },
                "references": { "type": ["array", "null"], "items": { "$ref": "./Friflo.Json.Fliox.Hub.Protocol.Models.json#/definitions/ReferencesResult" } }
            },
            "required": [
                "task",
                "ids"
            ],
            "additionalProperties": false
        },
        "AggregateEntitiesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task":      { "enum": ["aggregate"] },
                "container": { "type": ["string", "null"] },
                "value":     { "oneOf": [{ "$ref": "./Standard.json#/definitions/double" }, {"type": "null"}] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "PatchEntitiesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["patch"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "DeleteEntitiesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["delete"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "SendMessageResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncMessageResult" },
            "properties": {
                "task": { "enum": ["message"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "SyncMessageResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "isAbstract": true,
            "properties": {

            },
            "additionalProperties": false
        },
        "SendCommandResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncMessageResult" },
            "properties": {
                "task":   { "enum": ["command"] },
                "result": {  }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "CloseCursorsResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task":  { "enum": ["closeCursors"] },
                "count": { "$ref": "./Standard.json#/definitions/int32" }
            },
            "required": [
                "task",
                "count"
            ],
            "additionalProperties": false
        },
        "SubscribeChangesResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["subscribeChanges"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "SubscribeMessageResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["subscribeMessage"] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "ReserveKeysResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task": { "enum": ["reserveKeys"] },
                "keys": { "oneOf": [{ "$ref": "#/definitions/ReservedKeys" }, {"type": "null"}] }
            },
            "required": [
                "task"
            ],
            "additionalProperties": false
        },
        "ReservedKeys": {
            "type": "object",
            "isStruct": true,
            "properties": {
                "start": { "$ref": "./Standard.json#/definitions/int64" },
                "count": { "$ref": "./Standard.json#/definitions/int32" },
                "token": { "$ref": "./Standard.json#/definitions/Guid" }
            },
            "required": [
                "start",
                "count",
                "token"
            ],
            "additionalProperties": false
        },
        "TaskErrorResult": {
            "type": "object",
            "extends": { "$ref": "#/definitions/SyncTaskResult" },
            "properties": {
                "task":       { "enum": ["error"] },
                "type":       { "$ref": "#/definitions/TaskErrorResultType" },
                "message":    { "type": ["string", "null"] },
                "stacktrace": { "type": ["string", "null"] }
            },
            "required": [
                "task",
                "type"
            ],
            "additionalProperties": false
        },
        "TaskErrorResultType": {
            "enum": [
                "None",
                "UnhandledException",
                "DatabaseError",
                "FilterError",
                "ValidationError",
                "CommandError",
                "InvalidTask",
                "NotImplemented",
                "PermissionDenied",
                "SyncError"
            ],
            "descriptions": {
                "UnhandledException": "Unhandled exception while executing a task.<br/>\nmaps to HTTP status: 500",
                "DatabaseError":      "General database error while task execution.<br/>\nE.g. the access is currently not available or accessing a missing table.<br/>\nmaps to HTTP status: 500",
                "FilterError":        "Invalid query filter   <br/> maps to HTTP status: 400",
                "ValidationError":    "Schema validation of an entity failed  <br/> maps to HTTP status: 400",
                "CommandError":       "Execution of message / command failed caused by invalid input  <br/>maps to HTTP status: 400",
                "InvalidTask":        "Invalid task. E.g. by using an invalid task parameter  <br/>maps to HTTP status: 400",
                "NotImplemented":     "database message / command not implemented     <br/>maps to HTTP status: 501",
                "PermissionDenied":   "task execution not authorized  <br/>maps to HTTP status: 403",
                "SyncError":          "The entire <b>SyncRequest</b> containing a task failed  <br/>maps to HTTP status: 500"
            }

        }
    }
}

